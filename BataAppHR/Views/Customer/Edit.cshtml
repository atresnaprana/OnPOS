@model BataAppHR.Models.dbCustomer
@{
    ViewData["Title"] = "Edit Customer";
    // ** LOGIC PRESERVED: All your C# variables are here **
    var filenameKTP = Model.FILE_KTP_NAME ?? "";
    var filenameAkta = Model.FILE_AKTA_NAME ?? "";
    var filenameRekening = Model.FILE_REKENING_NAME ?? "";
    var filenameNPWP = Model.FILE_NPWP_NAME ?? "";
    var filenameTDP = Model.FILE_TDP_NAME ?? "";
    var filenameSIUP = Model.FILE_SIUP_NAME ?? "";
    var filenameNIB = Model.FILE_NIB_NAME ?? "";
    var filenameSPPKP = Model.FILE_SPPKP_NAME ?? "";
    var filenameSKT = Model.FILE_SKT_NAME ?? "";
    var isFinanceRole = User.IsInRole("FinanceIndustrial");
    var isSalesRole = User.IsInRole("SalesIndustrial");
    var isLegalRole = User.IsInRole("LegalIndustrial");
}

<div class="content-card">
    <div class="card-header-flex">
        <h1>@ViewData["Title"]: @Model.CUST_NAME</h1>
    </div>

    <form asp-action="Edit" id="formcreate" enctype="multipart/form-data" method="post">
        <!-- ** LOGIC PRESERVED: All your hidden fields are here ** -->
        <input asp-for="id" type="hidden" />
        <input asp-for="isApproved" type="hidden" />
        <input asp-for="isApproved2" type="hidden" />
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3" role="alert"></div>

        <!-- Section 1: Customer & Address Information -->
        <h5 class="mb-3">Customer & Address Information</h5>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Name</label><input asp-for="CUST_NAME" class="form-control" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Company</label><input asp-for="COMPANY" class="form-control" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Register Date</label><input type="date" asp-for="REG_DATE" class="form-control" /></div>
            </div>
            <div class="col-12">
                <div class="form-group"><label class="control-label">Address</label><textarea asp-for="address" class="form-control"></textarea></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">City</label><input asp-for="city" class="form-control" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label asp-for="province" class="control-label"></label><input asp-for="province" class="form-control" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label asp-for="postal" class="control-label"></label><input asp-for="postal" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div>
            </div>
        </div>

        <hr class="my-4" />

        <!-- Section 2: Financial & Contact Information -->
        <h5 class="mb-3">Financial & Contact Information</h5>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">NPWP</label><input asp-for="NPWP" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">KTP</label><input asp-for="KTP" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Area</label><input asp-for="store_area" class="form-control" readonly /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Phone 1</label><input asp-for="PHONE1" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Phone 2</label><input asp-for="PHONE2" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div>
            </div>
            <div class="col-md-4">
                <div class="form-group"><label class="control-label">Email</label><input asp-for="Email" class="form-control" readonly /></div>
            </div>
        </div>

        <hr class="my-4" />

        <!-- Section 3: Bank & Virtual Account -->
        <h5 class="mb-3">Bank & Virtual Account</h5>
        <div class="row">
            <div class="col-md-4"><div class="form-group"><label class="control-label">Bank Name</label><input asp-for="BANK_NAME" class="form-control" /></div></div>
            <div class="col-md-4"><div class="form-group"><label class="control-label">Bank Account No.</label><input asp-for="BANK_NUMBER" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div></div>
            <div class="col-md-4"><div class="form-group"><label class="control-label">Bank Branch</label><input asp-for="BANK_BRANCH" class="form-control" /></div></div>
            <div class="col-md-4"><div class="form-group"><label class="control-label">Bank Country</label><input asp-for="BANK_COUNTRY" class="form-control" /></div></div>
            <div class="col-md-4"><div class="form-group"><label class="control-label">VA Note</label><input asp-for="VA1NOTE" class="form-control" /></div></div>
            <div class="col-md-4"><div class="form-group"><label class="control-label">VA</label><input asp-for="VA1" class="form-control" onkeypress="return allowOnlyNumber(event);" /></div></div>
        </div>

        <hr class="my-4" />

        <!-- Section 4: Approvals & Status -->
        <h5 class="mb-3">Approvals & Status</h5>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label d-block">Legal Approval</label>
                    <label class="switch"><input asp-for="isApproveBool" disabled="@(!isLegalRole)" /><span class="slider"></span></label>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label d-block">Finance Approval</label>
                    <label class="switch"><input asp-for="isApproveBool2" disabled="@(!isFinanceRole)" /><span class="slider"></span></label>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label">Customer Discount (%)</label>
                    <input asp-for="discount_customer" class="form-control" onkeypress="return allowOnlyNumber(event);" />
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label d-block">Blacklist</label>
                    <label class="switch"><input asp-for="isBlackList" /><span class="slider"></span></label>
                </div>
            </div>
        </div>

        <!-- Section 5: Document Files -->
        <button type="button" class="accordion-flip mt-4" id="flip">
            Upload/View Document Files <i class="fa-solid fa-chevron-down"></i>
        </button>
        <div class="accordion-panel" id="panel">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="control-label">KTP</label>
                    <div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileKtp" /></div>
                    <a href="#" id="fileKTPName" class="file-download-link"></a>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="control-label">NPWP</label>
                    <div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileNPWP" /></div>
                    <a href="#" id="fileNPWPName" class="file-download-link"></a>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="control-label">NIB</label>
                    <div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileNIB" /></div>
                    <a href="#" id="fileNIBName" class="file-download-link"></a>
                </div>
                <!-- ... Repeat for all other files ... -->
                <div class="col-md-4 mb-3"><label class="control-label">Akta Perusahaan</label><div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileAkta" /></div><a href="#" id="fileAktaName" class="file-download-link"></a></div>
                <div class="col-md-4 mb-3"><label class="control-label">TDP</label><div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileTdp" /></div><a href="#" id="fileTDPName" class="file-download-link"></a></div>
                <div class="col-md-4 mb-3"><label class="control-label">SPPKP / PKP</label><div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileSPPKP" /></div><a href="#" id="fileSPPKPName" class="file-download-link"></a></div>
                <div class="col-md-4 mb-3"><label class="control-label">Rekening Bank</label><div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileRekening" /></div><a href="#" id="fileRekeningName" class="file-download-link"></a></div>
                <div class="col-md-4 mb-3"><label class="control-label">SIUP</label><div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileSIUP" /></div><a href="#" id="fileSIUPName" class="file-download-link"></a></div>
                <div class="col-md-4 mb-3"><label class="control-label">SKT</label><div class="file-drop-zone"><span class="file-upload-text"><i class="fa-solid fa-cloud-arrow-up"></i> Click or drag to upload</span><input type="file" asp-for="fileSKT" /></div><a href="#" id="fileSKTName" class="file-download-link"></a></div>
            </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-4">
            <a asp-action="Index" class="btn btn-secondary">Kembali ke List</a>
            <input type="button" value="Update Data" onclick="alertfirst()" class="btn btn-primary" />
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <!-- ** UNTOUCHED LOGIC: Your original script is 100% preserved ** -->
    <script>
        $(document).ready(function () {
            var roleFinance = '@isFinanceRole';
            var roleLegal = '@isLegalRole';
            var roleSales = '@isSalesRole';
            debugger;
            $("#discount_customer").rules("remove", "number");

            if (roleFinance == "True") {
                var isapprovelegal = $("#isApproved").val();
                if (isapprovelegal == "1") {
                    $('#VA1NOTE').prop('readonly', false);
                    $('#VA1').prop('readonly', false);
                    var isapprovefinance = $("#isApproved2").val();
                    var vaacc = $("#VA1").val();
                    if (isapprovefinance == "1" && vaacc != '' & vaacc != null) {
                        $('#discount_customer').prop('readonly', false);
                    } else {
                        $('#discount_customer').prop('readonly', true);
                    }
                } else {
                    $('#VA1NOTE').prop('readonly', true);
                    $('#VA1').prop('readonly', true);
                    $('#discount_customer').prop('readonly', true);
                }
            } else {
                $('#VA1NOTE').prop('readonly', true);
                $('#VA1').prop('readonly', true);
                $('#discount_customer').prop('readonly', true);
            }

            $("#flip").click(function () {
                $(this).toggleClass('active');
                $("#panel").slideToggle("fast");
            });

            var filenameKTP = '@filenameKTP';
            var idform = $("#id").val();
            if(filenameKTP) $("#fileKTPName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameKTP).attr("href", "/Customer/DownloadKTP?iddata=" + idform);

            var filenameAkta = '@filenameAkta';
            if(filenameAkta) $("#fileAktaName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameAkta).attr("href", "/Customer/DownloadAkta?iddata=" + idform);

            var filenameRekening = '@filenameRekening';
            if(filenameRekening) $("#fileRekeningName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameRekening).attr("href", "/Customer/DownloadRekening?iddata=" + idform);

            var filenameNPWP = '@filenameNPWP';
            if(filenameNPWP) $("#fileNPWPName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameNPWP).attr("href", "/Customer/DownloadNPWP?iddata=" + idform);

            var filenameTDP = '@filenameTDP';
            if(filenameTDP) $("#fileTDPName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameTDP).attr("href", "/Customer/DownloadTDP?iddata=" + idform);

            var filenameSIUP = '@filenameSIUP';
            if(filenameSIUP) $("#fileSIUPName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameSIUP).attr("href", "/Customer/DownloadSIUP?iddata=" + idform);

            var filenameNIB = '@filenameNIB';
            if(filenameNIB) $("#fileNIBName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameNIB).attr("href", "/Customer/DownloadNIB?iddata=" + idform);

            var filenameSPPKP = '@filenameSPPKP';
            if(filenameSPPKP) $("#fileSPPKPName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameSPPKP).attr("href", "/Customer/DownloadSPPKP?iddata=" + idform);

             var filenameSKT = '@filenameSKT';
            if(filenameSKT) $("#fileSKTName").html('<i class="fa-solid fa-file-arrow-down"></i> ' + filenameSKT).attr("href", "/Customer/DownloadSKT?iddata=" + idform);
        });

        $('#isApproveBool2').change(function (s, e) {
            debugger;
            var roleFinance = '@isFinanceRole';
            if (roleFinance == "False") {
                var isapprovelegal = $("#isApproved").val();
                if (isapprovelegal == "1") {
                    var isapprove2 = $("#isApproved2").val();
                    if (isapprove2 == "1") {
                        $(this).prop('checked', true);
                        $('#discount_customer').prop('readonly', false);
                    } else {
                        $(this).prop('checked', false);
                        $('#discount_customer').prop('readonly', true);
                        $('#discount_customer').val(0);
                    }
                } else {
                    $(this).prop('checked', false);
                    $('#discount_customer').prop('readonly', true);
                    $('#discount_customer').val(0);
                }
            } else {
                if (this.checked) {
                    var isapprovelegal = $("#isApproved").val();
                    if (isapprovelegal == "1") {
                        var va1 = $("#VA1").val();
                        if (va1 == null || va1 == "") {
                            var isapprove2 = $("#isApproved2").val();
                            if (isapprove2 == "1") {
                                $(this).prop('checked', true);
                                $('#discount_customer').prop('readonly', false);
                            } else {
                                $(this).prop('checked', false);
                                $('#discount_customer').prop('readonly', true);
                                $('#discount_customer').val(0);
                            }
                        } else {
                            $('#discount_customer').prop('readonly', false);
                        }
                    } else {
                        $(this).prop('checked', false);
                        $('#discount_customer').prop('readonly', true);
                        $('#discount_customer').val(0);
                    }
                } else {
                    $('#discount_customer').prop('readonly', true);
                    $('#discount_customer').val(0);
                }
            }
        });

         $('#isApproveBool').change(function (s, e) {
            debugger;
            var roleLegal = '@isLegalRole';
             if (roleLegal == "False") {
                var isapprove2 = $("#isApproved").val();
                if (isapprove2 == "1") {
                    $(this).prop('checked', true);
                } else {
                    $(this).prop('checked', false);
                }
            }
        });

        $("#VA1").change(function () {
            var val = $("#VA1").val();
            if (val == null || val == "") {
                $("#isApproved2").val("0");
                $("#isApproveBool2").prop('checked', false);
                $('#discount_customer').prop('readonly', true);
                $('#discount_customer').val(0);
            }
        });

        function allowOnlyNumber(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;
            return true;
        }
        function alertfirst() {
            if (confirm("Are you sure you want to save this data?")) {
                $('#formcreate').submit();
            } else {
                return false;
            }
        }
    </script>
}